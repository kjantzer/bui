{"version":3,"sources":["../../src/layouts/shared/SizeCache.ts","../node_modules/parcel-bundler/src/builtins/bundle-url.js","../node_modules/parcel-bundler/src/builtins/bundle-loader.js","../src/polyfillLoaders/EventTarget.ts","../../src/layouts/shared/BaseLayout.ts","../src/layouts/flow.ts","../node_modules/parcel-bundler/src/builtins/loaders/browser/js-loader.js"],"names":["bundleURL","getBundleURLCached","getBundleURL","Error","err","matches","stack","match","getBaseURL","url","replace","exports","require","loadBundlesLazy","bundles","Array","isArray","id","length","Promise","resolve","code","LazyPromise","reject","loadBundles","slice","then","all","map","loadBundle","bundleLoaders","registerBundleLoader","type","loader","module","load","register","bundle","substring","lastIndexOf","toLowerCase","bundleLoader","resolved","catch","e","executor","promise","prototype","onSuccess","onError","loadJSBundle","script","document","createElement","async","charset","src","onerror","onload","getElementsByTagName","appendChild"],"mappings":"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","file":"flow.80eb2b58.js","sourceRoot":"../demo","sourcesContent":["export interface SizeCacheConfig {\n    roundAverageSize?: boolean\n}\n\nexport class SizeCache {\n    private _map: Map<number | string, number> = new Map();\n    private _roundAverageSize = true;\n    totalSize: number = 0;\n\n    constructor(config?: SizeCacheConfig) {\n        if (config?.roundAverageSize === false) {\n            this._roundAverageSize = false;\n        }\n    }\n  \n    set(index: number | string, value: number): void {\n      const prev = this._map.get(index) || 0;\n      this._map.set(index, value);\n      this.totalSize += value - prev;\n    }\n  \n    get averageSize(): number {\n        if (this._map.size > 0) {\n            const average = this.totalSize / this._map.size;\n            return this._roundAverageSize\n            ? Math.round(average)\n            : average;\n        }\n        return 0;\n    }\n  \n    getSize(index: number | string) {\n      return this._map.get(index);\n    }\n  \n    clear() {\n      this._map.clear();\n      this.totalSize = 0;\n    }\n}","var bundleURL = null;\nfunction getBundleURLCached() {\n  if (!bundleURL) {\n    bundleURL = getBundleURL();\n  }\n\n  return bundleURL;\n}\n\nfunction getBundleURL() {\n  // Attempt to find the URL of the current script and use that as the base URL\n  try {\n    throw new Error;\n  } catch (err) {\n    var matches = ('' + err.stack).match(/(https?|file|ftp|chrome-extension|moz-extension):\\/\\/[^)\\n]+/g);\n    if (matches) {\n      return getBaseURL(matches[0]);\n    }\n  }\n\n  return '/';\n}\n\nfunction getBaseURL(url) {\n  return ('' + url).replace(/^((?:https?|file|ftp|chrome-extension|moz-extension):\\/\\/.+)?\\/[^/]+(?:\\?.*)?$/, '$1') + '/';\n}\n\nexports.getBundleURL = getBundleURLCached;\nexports.getBaseURL = getBaseURL;\n","var getBundleURL = require('./bundle-url').getBundleURL;\n\nfunction loadBundlesLazy(bundles) {\n  if (!Array.isArray(bundles)) {\n    bundles = [bundles]\n  }\n\n  var id = bundles[bundles.length - 1];\n\n  try {\n    return Promise.resolve(require(id));\n  } catch (err) {\n    if (err.code === 'MODULE_NOT_FOUND') {\n      return new LazyPromise(function (resolve, reject) {\n        loadBundles(bundles.slice(0, -1))\n          .then(function () {\n            return require(id);\n          })\n          .then(resolve, reject);\n      });\n    }\n\n    throw err;\n  }\n}\n\nfunction loadBundles(bundles) {\n  return Promise.all(bundles.map(loadBundle));\n}\n\nvar bundleLoaders = {};\nfunction registerBundleLoader(type, loader) {\n  bundleLoaders[type] = loader;\n}\n\nmodule.exports = exports = loadBundlesLazy;\nexports.load = loadBundles;\nexports.register = registerBundleLoader;\n\nvar bundles = {};\nfunction loadBundle(bundle) {\n  var id;\n  if (Array.isArray(bundle)) {\n    id = bundle[1];\n    bundle = bundle[0];\n  }\n\n  if (bundles[bundle]) {\n    return bundles[bundle];\n  }\n\n  var type = (bundle.substring(bundle.lastIndexOf('.') + 1, bundle.length) || bundle).toLowerCase();\n  var bundleLoader = bundleLoaders[type];\n  if (bundleLoader) {\n    return bundles[bundle] = bundleLoader(getBundleURL() + bundle)\n      .then(function (resolved) {\n        if (resolved) {\n          module.bundle.register(id, resolved);\n        }\n\n        return resolved;\n      }).catch(function(e) {\n        delete bundles[bundle];\n        \n        throw e;\n      });\n  }\n}\n\nfunction LazyPromise(executor) {\n  this.executor = executor;\n  this.promise = null;\n}\n\nLazyPromise.prototype.then = function (onSuccess, onError) {\n  if (this.promise === null) this.promise = new Promise(this.executor)\n  return this.promise.then(onSuccess, onError)\n};\n\nLazyPromise.prototype.catch = function (onError) {\n  if (this.promise === null) this.promise = new Promise(this.executor)\n  return this.promise.catch(onError)\n};\n","/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\n\ntype EventTargetModule = typeof import('event-target-shim');\n\ninterface EventTargetConstructor {\n    new(): EventTarget\n}\n\nlet _ET: EventTargetModule | EventTargetConstructor;\nlet ET: EventTargetConstructor;\n\nexport default async function EventTarget() {\n    return ET || init();\n}\n\nasync function init() {\n    _ET = window.EventTarget;\n    try {\n        new _ET();\n    }\n    catch {\n        _ET = (await import('event-target-shim')).EventTarget;\n    }\n    return (ET = _ET);\n}\n","/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\n\nimport EventTarget from '../../polyfillLoaders/EventTarget.js';\nimport {Layout, Positions, ScrollDirection, Size, dimension, position} from './Layout.js';\n\ntype UpdateVisibleIndicesOptions = {\n  emit?: boolean\n}\n\nexport interface BaseLayoutConfig {\n  direction?: ScrollDirection\n}\n\nexport function dim1(direction: ScrollDirection): dimension {\n  return direction === 'horizontal' ? 'width': 'height';\n}\n\nexport function dim2(direction: ScrollDirection): dimension {\n  return direction === 'horizontal' ? 'height': 'width';\n}\n\nexport function pos1(direction: ScrollDirection): position {\n  return direction === 'horizontal' ? 'left': 'top';\n}\n\nexport function pos2(direction: ScrollDirection): position {\n  return direction === 'horizontal' ? 'top': 'left';\n}\n\nexport abstract class BaseLayout<C extends BaseLayoutConfig> implements Layout {\n  /**\n   * The last set viewport scroll position.\n   */\n  private _latestCoords: Positions = {left: 0, top: 0};\n\n  /**\n   * Scrolling direction.\n   */\n  private _direction: ScrollDirection | null = null;\n\n  /**\n   * Dimensions of the viewport.\n   */\n  private _viewportSize: Size = {width: 0, height: 0};\n\n  /**\n   * Flag for debouncing asynchnronous reflow requests.\n   */\n  private _pendingReflow = false;\n\n  private _pendingLayoutUpdate = false;\n\n  /**\n   * Index of the item that has been scrolled to via the public API. When the\n   * viewport is otherwise scrolled, this value is set back to -1.\n   */\n  protected _scrollToIndex = -1;\n\n  /**\n   * When a child is scrolled to, the offset from the top of the child and the\n   * top of the viewport. Value is a proportion of the item size.\n   */\n  private _scrollToAnchor = 0;\n\n  /**\n   * The index of the first item intersecting the viewport.\n   */\n  protected _firstVisible = 0;\n\n  /**\n   * The index of the last item intersecting the viewport.\n   */\n  protected _lastVisible = 0;\n\n  private _eventTargetPromise: Promise<void> = (EventTarget().then((Ctor) => {\n    this._eventTarget = new Ctor();\n  }));\n\n  /**\n   * Pixel offset in the scroll direction of the first child.\n   */\n  protected _physicalMin = 0;\n\n  /**\n   * Pixel offset in the scroll direction of the last child.\n   */\n  protected _physicalMax = 0;\n\n  /**\n   * Index of the first child.\n   */\n  protected _first = -1;\n\n  /**\n   * Index of the last child.\n   */\n  protected _last = -1;\n\n  /**\n   * Length in the scrolling direction.\n   */\n  protected _sizeDim: dimension = 'height';\n\n  /**\n   * Length in the non-scrolling direction.\n   */\n  protected _secondarySizeDim: dimension = 'width';\n\n  /**\n   * Position in the scrolling direction.\n   */\n  protected _positionDim: position = 'top';\n\n  /**\n   * Position in the non-scrolling direction.\n   */\n  protected _secondaryPositionDim: position = 'left';\n\n  /**\n   * Current scroll offset in pixels.\n   */\n  protected _scrollPosition = 0;\n\n  /**\n   * Difference between current scroll offset and scroll offset calculated due\n   * to a reflow.\n   */\n  protected _scrollError = 0;\n\n  /**\n   * Total number of items that could possibly be displayed. Used to help\n   * calculate the scroll size.\n   */\n  protected _totalItems = 0;\n\n  /**\n   * The total (estimated) length of all items in the scrolling direction.\n   */\n  protected _scrollSize = 1;\n\n  /**\n   * Number of pixels beyond the viewport to still include\n   * in the active range of items.\n   */\n  // TODO (graynorton): Probably want to make this something we calculate based\n  // on viewport size, item size, other factors, possibly still with a dial of some kind\n  protected _overhang = 1000;\n\n  private _eventTarget: EventTarget | null = null;\n\n  protected get _defaultConfig() : C {\n    return {\n      direction: 'vertical'\n    } as C\n  }\n\n  constructor(config?: C) {\n    // Delay setting config so that subclasses do setup work first\n    Promise.resolve().then(() => this.config = config || this._defaultConfig);\n  }\n\n  set config(config: C) {\n    Object.assign(this, Object.assign({}, this._defaultConfig, config));\n  }\n\n  get config(): C {\n    return {\n      direction: this.direction\n    } as C;\n  }\n\n  /**\n   * Maximum index of children + 1, to help estimate total height of the scroll\n   * space.\n   */\n  get totalItems(): number {\n    return this._totalItems;\n  }\n  set totalItems(num) {\n    const _num = Number(num);\n    if (_num !== this._totalItems) {\n      this._totalItems = _num;\n      this._scheduleReflow();\n    }\n  }\n\n  /**\n   * Primary scrolling direction.\n   */\n  get direction(): ScrollDirection {\n    return this._direction!;\n  }\n  set direction(dir) {\n    // Force it to be either horizontal or vertical.\n    dir = (dir === 'horizontal') ? dir : 'vertical';\n    if (dir !== this._direction) {\n      this._direction = dir;\n      this._sizeDim = (dir === 'horizontal') ? 'width' : 'height';\n      this._secondarySizeDim = (dir === 'horizontal') ? 'height' : 'width';\n      this._positionDim = (dir === 'horizontal') ? 'left' : 'top';\n      this._secondaryPositionDim = (dir === 'horizontal') ? 'top' : 'left';\n      this._triggerReflow();\n    }\n  }\n\n  /**\n   * Height and width of the viewport.\n   */\n  get viewportSize(): Size {\n    return this._viewportSize;\n  }\n  set viewportSize(dims) {\n    const {_viewDim1, _viewDim2} = this;\n    Object.assign(this._viewportSize, dims);\n    if (_viewDim2 !== this._viewDim2) {\n      // this._viewDim2Changed();\n      this._scheduleLayoutUpdate();\n    } else if (_viewDim1 !== this._viewDim1) {\n      this._checkThresholds();\n    }\n  }\n\n  /**\n   * Scroll offset of the viewport.\n   */\n  get viewportScroll(): Positions {\n    return this._latestCoords;\n  }\n  set viewportScroll(coords) {\n    Object.assign(this._latestCoords, coords);\n    const oldPos = this._scrollPosition;\n    this._scrollPosition = this._latestCoords[this._positionDim];\n    if (oldPos !== this._scrollPosition) {\n      this._scrollPositionChanged(oldPos, this._scrollPosition);\n      this._updateVisibleIndices({emit: true});\n    }\n    this._checkThresholds();\n  }\n\n  /**\n   * Perform a reflow if one has been scheduled.\n   */\n  reflowIfNeeded(force: boolean = false) {\n    if (force || this._pendingReflow) {\n      this._pendingReflow = false;\n      this._reflow();\n    }\n  }\n\n  /**\n   * Scroll to the child at the given index, and the given position within that\n   * child.\n   */\n  scrollToIndex(index: number, position = 'start') {\n    if (!Number.isFinite(index))\n      return;\n    index = Math.min(this.totalItems, Math.max(0, index));\n    this._scrollToIndex = index;\n    if (position === 'nearest') {\n      position = index > this._first + this._num / 2 ? 'end' : 'start';\n    }\n    switch (position) {\n      case 'start':\n        this._scrollToAnchor = 0;\n        break;\n      case 'center':\n        this._scrollToAnchor = 0.5;\n        break;\n      case 'end':\n        this._scrollToAnchor = 1;\n        break;\n      default:\n        throw new TypeError(\n            'position must be one of: start, center, end, nearest');\n    }\n    this._scheduleReflow();\n  }\n\n  async dispatchEvent(evt: Event) {\n    await this._eventTargetPromise;\n    this._eventTarget!.dispatchEvent(evt);\n  }\n\n  async addEventListener(type: string, listener: EventListener | EventListenerObject | null, options?: boolean | AddEventListenerOptions | undefined) {\n    await this._eventTargetPromise;\n    this._eventTarget!.addEventListener(type, listener, options);\n  }\n\n  async removeEventListener(type: string, callback: EventListener | EventListenerObject | null, options?: boolean | EventListenerOptions | undefined) {\n    await this._eventTargetPromise;\n    this._eventTarget!.removeEventListener(type, callback, options);\n  }\n\n  /**\n   * Get the top and left positioning of the item at idx.\n   */\n  protected abstract _getItemPosition(idx: number): Positions;\n\n  /**\n   * Update _first and _last based on items that should be in the current\n   * range.\n   */\n  protected abstract _getActiveItems(): void\n\n  protected abstract _getItemSize(_idx: number): Size\n\n    /**\n   * Calculates (precisely or by estimating, if needed) the total length of all items in\n   * the scrolling direction, including spacing, caching the value in the `_scrollSize` field.\n   * \n   * Should return a minimum value of 1 to ensure at least one item is rendered.\n   * TODO (graynorton): Possibly no longer required, but leaving here until it can be verified.\n   */\n  protected abstract _updateScrollSize(): void\n\n  protected _updateLayout(): void {\n    // Override\n  }\n\n  // protected _viewDim2Changed(): void {\n  //   this._scheduleLayoutUpdate();\n  // }\n\n  /**\n   * The height or width of the viewport, whichever corresponds to the scrolling direction.\n   */\n  protected get _viewDim1(): number {\n    return this._viewportSize[this._sizeDim];\n  }\n\n  /**\n   * The height or width of the viewport, whichever does NOT correspond to the scrolling direction.\n   */\n  protected get _viewDim2(): number {\n    return this._viewportSize[this._secondarySizeDim];\n  }\n\n  protected _scheduleReflow() {\n    this._pendingReflow = true;\n  }\n\n  protected _scheduleLayoutUpdate() {\n    this._pendingLayoutUpdate = true;\n    this._scheduleReflow();\n  }\n\n  // For triggering a reflow based on incoming changes to\n  // the layout config.\n  protected _triggerReflow() {\n    this._scheduleLayoutUpdate();\n    // TODO graynorton@: reflowIfNeeded() isn't really supposed\n    // to be called internally. Address in larger cleanup\n    // of virtualizer / layout interaction pattern.\n    // this.reflowIfNeeded(true);\n    Promise.resolve().then(() => this.reflowIfNeeded());\n  }\n\n  protected _reflow() {\n    if (this._pendingLayoutUpdate) {\n      this._updateLayout();\n      this._pendingLayoutUpdate = false;\n    }\n    this._updateScrollSize();\n    this._getActiveItems();\n    this._scrollIfNeeded();\n    this._updateVisibleIndices();\n    this._emitScrollSize();\n    this._emitRange();\n    this._emitChildPositions();\n    this._emitScrollError();\n  }\n\n  protected _scrollIfNeeded() {\n    if (this._scrollToIndex === -1) {\n      return;\n    }\n    const index = this._scrollToIndex;\n    const anchor = this._scrollToAnchor;\n    const pos = this._getItemPosition(index)[this._positionDim];\n    const size = this._getItemSize(index)[this._sizeDim];\n\n    const curAnchorPos = this._scrollPosition + this._viewDim1 * anchor;\n    const newAnchorPos = pos + size * anchor;\n    // Ensure scroll position is an integer within scroll bounds.\n    const scrollPosition = Math.floor(Math.min(\n        this._scrollSize - this._viewDim1,\n        Math.max(0, this._scrollPosition - curAnchorPos + newAnchorPos)));\n    this._scrollError += this._scrollPosition - scrollPosition;\n    this._scrollPosition = scrollPosition;\n  }\n\n  protected _emitRange(inProps: unknown = undefined) {\n    const detail = Object.assign(\n        {\n          first: this._first,\n          last: this._last,\n          num: this._num,\n          stable: true,\n          firstVisible: this._firstVisible,\n          lastVisible: this._lastVisible,\n        },\n        inProps);\n    this.dispatchEvent(new CustomEvent('rangechange', {detail}));\n  }\n\n  protected _emitScrollSize() {\n    const detail = {\n      [this._sizeDim]: this._scrollSize,\n    };\n    this.dispatchEvent(new CustomEvent('scrollsizechange', {detail}));\n  }\n\n  protected _emitScrollError() {\n    if (this._scrollError) {\n      const detail = {\n        [this._positionDim]: this._scrollError,\n        [this._secondaryPositionDim]: 0,\n      };\n      this.dispatchEvent(new CustomEvent('scrollerrorchange', {detail}));\n      this._scrollError = 0;\n    }\n  }\n\n  /**\n   * Get or estimate the top and left positions of items in the current range.\n   * Emit an itempositionchange event with these positions.\n   */\n  protected _emitChildPositions() {\n    const detail: {[key: number]: Positions} = {};\n    for (let idx = this._first; idx <= this._last; idx++) {\n      detail[idx] = this._getItemPosition(idx);\n    }\n    this.dispatchEvent(new CustomEvent('itempositionchange', {detail}));\n  }\n\n  /**\n   * Number of items to display.\n   */\n  private get _num(): number {\n    if (this._first === -1 || this._last === -1) {\n      return 0;\n    }\n    return this._last - this._first + 1;\n  }\n\n  private _checkThresholds() {\n    if (this._viewDim1 === 0 && this._num > 0) {\n      this._scheduleReflow();\n    } else {\n      const min = Math.max(0, this._scrollPosition - this._overhang);\n      const max = Math.min(\n          this._scrollSize,\n          this._scrollPosition + this._viewDim1 + this._overhang);\n      if (this._physicalMin > min || this._physicalMax < max) {\n        this._scheduleReflow();\n      }\n    }\n  }\n\n  /**\n   * Find the indices of the first and last items to intersect the viewport.\n   * Emit a visibleindiceschange event when either index changes.\n   */\n   protected _updateVisibleIndices(options?: UpdateVisibleIndicesOptions) {\n    if (this._first === -1 || this._last === -1) return;\n\n    let firstVisible = this._first;\n    while (\n      firstVisible < this._last &&\n      Math.round(\n        this._getItemPosition(firstVisible)[this._positionDim] +\n        this._getItemSize(firstVisible)[this._sizeDim]\n      )\n      <=\n      Math.round (this._scrollPosition)\n     ) {\n      firstVisible++;\n    }\n\n    let lastVisible = this._last;\n    while (\n      lastVisible > this._first &&\n      Math.round(this._getItemPosition(lastVisible)[this._positionDim])\n      >=\n      Math.round(this._scrollPosition + this._viewDim1)\n    ) {\n      lastVisible--;\n    }\n\n    if (firstVisible !== this._firstVisible || lastVisible !== this._lastVisible) {\n      this._firstVisible = firstVisible;\n      this._lastVisible = lastVisible;\n      if (options && options.emit) {\n        this._emitRange();\n      }\n    }\n  }\n\n  private _scrollPositionChanged(oldPos: number, newPos: number) {\n    // When both values are bigger than the max scroll position, keep the\n    // current _scrollToIndex, otherwise invalidate it.\n    const maxPos = this._scrollSize - this._viewDim1;\n    if (oldPos < maxPos || newPos < maxPos) {\n      this._scrollToIndex = -1;\n    }\n  }\n}\n","/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: BSD-3-Clause\n */\n\nimport { SizeCache } from './shared/SizeCache.js';\nimport {BaseLayout, BaseLayoutConfig, dim1} from './shared/BaseLayout.js';\nimport {ItemBox, Positions, Size, Margins, margin, ScrollDirection, offsetAxis} from './shared/Layout.js';\n\ntype ItemBounds = {\n  pos: number,\n  size: number\n};\n\ntype FlowLayoutConstructor = {\n  prototype: FlowLayout,\n  new(config?: BaseLayoutConfig): FlowLayout\n}\n\ntype FlowLayoutSpecifier = BaseLayoutConfig & {\n  type: FlowLayoutConstructor\n}\n\ntype FlowLayoutSpecifierFactory = (config?: BaseLayoutConfig) => FlowLayoutSpecifier;\n\nexport const flow: FlowLayoutSpecifierFactory = (config?: BaseLayoutConfig) => Object.assign({\n  type: FlowLayout\n}, config);\n\nfunction leadingMargin(direction: ScrollDirection): margin {\n  return direction === 'horizontal' ? 'marginLeft' : 'marginTop';\n}\n\nfunction trailingMargin(direction: ScrollDirection): margin {\n  return direction === 'horizontal' ? 'marginRight' : 'marginBottom';\n}\n\nfunction offset(direction: ScrollDirection): offsetAxis {\n  return direction === 'horizontal' ? 'xOffset' : 'yOffset';\n}\n\nfunction collapseMargins(a: number, b: number): number {\n  const m = [a, b].sort();\n  return m[1] <= 0\n  ? Math.min(...m)\n  : m[0] >= 0\n    ? Math.max(...m)\n    : m[0] + m[1];\n}\n\nclass MetricsCache {\n  private _childSizeCache = new SizeCache();\n  private _marginSizeCache = new SizeCache();\n  private _metricsCache: Map<number, Size & Margins> = new Map();\n\n  update(metrics: {[key: number]: Size & Margins}, direction: ScrollDirection) {\n    const marginsToUpdate: Set<number> = new Set();\n    Object.keys(metrics).forEach((key) => {\n      const k = Number(key);\n      this._metricsCache.set(k, metrics[k]);\n      this._childSizeCache.set(k, metrics[k][dim1(direction)]);\n      marginsToUpdate.add(k);\n      marginsToUpdate.add(k + 1);\n    });\n    for (const k of marginsToUpdate) {\n      const a = this._metricsCache.get(k)?.[leadingMargin(direction)] || 0;\n      const b = this._metricsCache.get(k - 1)?.[trailingMargin(direction)] || 0;\n      this._marginSizeCache.set(k, collapseMargins(a, b))\n    }\n  }\n\n  get averageChildSize(): number {\n    return this._childSizeCache.averageSize;\n  }\n\n  get totalChildSize(): number {\n    return this._childSizeCache.totalSize;\n  }\n\n  get averageMarginSize(): number {\n    return this._marginSizeCache.averageSize;\n  }\n\n  get totalMarginSize(): number {\n    return this._marginSizeCache.totalSize;\n  }\n\n  getLeadingMarginValue(index: number, direction: ScrollDirection) {\n    return this._metricsCache.get(index)?.[leadingMargin(direction)] || 0;\n  }\n\n  getChildSize(index: number) {\n    return this._childSizeCache.getSize(index);\n  }\n\n  getMarginSize(index: number) {\n    return this._marginSizeCache.getSize(index);\n  }\n\n  clear() {\n    this._childSizeCache.clear();\n    this._marginSizeCache.clear();\n    this._metricsCache.clear();\n  }\n}\n\nexport class FlowLayout extends BaseLayout<BaseLayoutConfig> {\n  /**\n   * Initial estimate of item size\n   */\n  _itemSize: Size = {width: 100, height: 100};\n\n  /**\n   * Indices of children mapped to their (position and length) in the scrolling\n   * direction. Used to keep track of children that are in range.\n   */\n  _physicalItems: Map<number, ItemBounds> = new Map();\n\n  /**\n   * Used in tandem with _physicalItems to track children in range across\n   * reflows.\n   */\n  _newPhysicalItems: Map<number, ItemBounds> = new Map();\n\n  /**\n   * Width and height of children by their index.\n   */\n  _metricsCache = new MetricsCache();\n\n  /**\n   * anchorIdx is the anchor around which we reflow. It is designed to allow\n   * jumping to any point of the scroll size. We choose it once and stick with\n   * it until stable. _first and _last are deduced around it.\n   */\n  _anchorIdx: number | null = null;\n\n  /**\n   * Position in the scrolling direction of the anchor child.\n   */\n  _anchorPos: number | null = null;\n\n  /**\n   * Whether all children in range were in range during the previous reflow.\n   */\n  _stable = true;\n\n  /**\n   * Whether to remeasure children during the next reflow.\n   */\n  _needsRemeasure = false;\n\n  private _measureChildren = true;\n\n  _estimate = true;\n\n  // protected _defaultConfig: BaseLayoutConfig = Object.assign({}, super._defaultConfig, {\n\n  // })\n\n  // constructor(config: Layout1dConfig) {\n  //   super(config);\n  // }\n\n  get measureChildren() {\n    return this._measureChildren;\n  }\n\n  /**\n   * Determine the average size of all children represented in the sizes\n   * argument.\n   */\n  updateItemSizes(sizes: {[key: number]: ItemBox}) {\n    this._metricsCache.update(sizes as Size & Margins, this.direction);\n    // if (this._nMeasured) {\n      // this._updateItemSize();\n      this._scheduleReflow();\n    // }\n  }\n\n  /**\n   * Set the average item size based on the total length and number of children\n   * in range.\n   */\n  // _updateItemSize() {\n  //   // Keep integer values.\n  //   this._itemSize[this._sizeDim] = this._metricsCache.averageChildSize;\n  // }\n\n  _getPhysicalItem(idx: number): ItemBounds | undefined {\n    return this._newPhysicalItems.get(idx) ?? this._physicalItems.get(idx);\n  }\n\n  _getSize(idx: number): number | undefined {\n    const item = this._getPhysicalItem(idx);\n    return item && this._metricsCache.getChildSize(idx);\n  }\n\n  _getAverageSize(): number {\n    return this._metricsCache.averageChildSize || this._itemSize[this._sizeDim];\n  }\n\n  /**\n   * Returns the position in the scrolling direction of the item at idx.\n   * Estimates it if the item at idx is not in the DOM.\n   */\n  _getPosition(idx: number): number {\n    const item = this._getPhysicalItem(idx);\n    const { averageMarginSize } = this._metricsCache;\n    return idx === 0\n      ? this._metricsCache.getMarginSize(0) ?? averageMarginSize\n      : item\n        ? item.pos\n        : averageMarginSize + idx * (averageMarginSize + this._getAverageSize());\n  }\n\n  _calculateAnchor(lower: number, upper: number): number {\n    if (lower <= 0) {\n      return 0;\n    }\n    if (upper > this._scrollSize - this._viewDim1) {\n      return this._totalItems - 1;\n    }\n    return Math.max(\n        0,\n        Math.min(\n            this._totalItems - 1,\n            Math.floor(((lower + upper) / 2) / this._delta)));\n  }\n\n  _getAnchor(lower: number, upper: number): number {\n    if (this._physicalItems.size === 0) {\n      return this._calculateAnchor(lower, upper);\n    }\n    if (this._first < 0) {\n      console.error('_getAnchor: negative _first');\n      return this._calculateAnchor(lower, upper);\n    }\n    if (this._last < 0) {\n      console.error('_getAnchor: negative _last');\n      return this._calculateAnchor(lower, upper);\n    }\n\n    const firstItem = this._getPhysicalItem(this._first),\n          lastItem = this._getPhysicalItem(this._last),\n          firstMin = firstItem!.pos,\n          lastMin = lastItem!.pos,\n          lastMax = lastMin + this._metricsCache.getChildSize(this._last)!;\n\n    if (lastMax < lower) {\n      // Window is entirely past physical items, calculate new anchor\n      return this._calculateAnchor(lower, upper);\n    }\n    if (firstMin > upper) {\n      // Window is entirely before physical items, calculate new anchor\n      return this._calculateAnchor(lower, upper);\n    }\n    // Window contains a physical item\n    // Find one, starting with the one that was previously first visible\n    let candidateIdx = this._firstVisible - 1;\n    let cMax = -Infinity;\n    while (cMax < lower) {\n      const candidate = this._getPhysicalItem(++candidateIdx);\n      cMax = candidate!.pos + this._metricsCache.getChildSize(candidateIdx)!;\n    }\n    return candidateIdx;\n  }\n\n  /**\n   * Updates _first and _last based on items that should be in the current\n   * viewed range.\n   */\n  _getActiveItems() {\n    if (this._viewDim1 === 0 || this._totalItems === 0) {\n      this._clearItems();\n    } else {\n      this._getItems();\n    }\n  }\n\n  /**\n   * Sets the range to empty.\n   */\n  _clearItems() {\n    this._first = -1;\n    this._last = -1;\n    this._physicalMin = 0;\n    this._physicalMax = 0;\n    const items = this._newPhysicalItems;\n    this._newPhysicalItems = this._physicalItems;\n    this._newPhysicalItems.clear();\n    this._physicalItems = items;\n    this._stable = true;\n  }\n\n  /*\n   * Updates _first and _last based on items that should be in the given range.\n   */\n  _getItems() {\n    const items = this._newPhysicalItems;\n    this._stable = true;\n    let lower, upper;\n\n    // The anchorIdx is the anchor around which we reflow. It is designed to\n    // allow jumping to any point of the scroll size. We choose it once and\n    // stick with it until stable. first and last are deduced around it.\n\n    // If we have a scrollToIndex, we anchor on the given\n    // index and set the scroll position accordingly\n    if (this._scrollToIndex >= 0) {\n      this._anchorIdx = Math.min(this._scrollToIndex, this._totalItems - 1);\n      this._anchorPos = this._getPosition(this._anchorIdx);\n      this._scrollIfNeeded();\n    }\n\n    // Determine the lower and upper bounds of the region to be\n    // rendered, relative to the viewport\n    lower = this._scrollPosition - this._overhang;//leadingOverhang;\n    upper = this._scrollPosition + this._viewDim1 + this._overhang;// trailingOverhang;\n\n    if (upper < 0 || lower > this._scrollSize) {\n      this._clearItems();\n      return;\n    }\n\n    // If we are scrolling to a specific index or if we are doing another\n    // pass to stabilize a previously started reflow, we will already\n    // have an anchor. If not, establish an anchor now.\n    if (this._anchorIdx === null || this._anchorPos === null) {\n      this._anchorIdx = this._getAnchor(lower, upper);\n      this._anchorPos = this._getPosition(this._anchorIdx);\n    }\n\n    let anchorSize = this._getSize(this._anchorIdx);\n    if (anchorSize === undefined) {\n      this._stable = false;\n      anchorSize = this._getAverageSize();\n    }\n\n    let anchorLeadingMargin = this._metricsCache.getMarginSize(this._anchorIdx) ?? this._metricsCache.averageMarginSize;\n    let anchorTrailingMargin = this._metricsCache.getMarginSize(this._anchorIdx + 1) ?? this._metricsCache.averageMarginSize;\n\n    if (this._anchorIdx === 0) {\n      this._anchorPos = anchorLeadingMargin;\n    }\n\n    if (this._anchorIdx === this._totalItems - 1) {\n      this._anchorPos = this._scrollSize - anchorTrailingMargin - anchorSize;\n    }\n\n    // Anchor might be outside bounds, so prefer correcting the error and keep\n    // that anchorIdx.\n    let anchorErr = 0;\n\n    if (this._anchorPos + anchorSize + anchorTrailingMargin < lower) {\n      anchorErr = lower - (this._anchorPos + anchorSize + anchorTrailingMargin);\n    }\n\n    if (this._anchorPos - anchorLeadingMargin > upper) {\n      anchorErr = upper - (this._anchorPos - anchorLeadingMargin);\n    }\n\n    if (anchorErr) {\n      this._scrollPosition -= anchorErr;\n      lower -= anchorErr;\n      upper -= anchorErr;\n      this._scrollError += anchorErr;\n    }\n\n    items.set(this._anchorIdx, {pos: this._anchorPos, size: anchorSize});\n\n    this._first = (this._last = this._anchorIdx);\n    this._physicalMin = this._anchorPos;\n    this._physicalMax = this._anchorPos + anchorSize;\n\n    while (this._physicalMin > lower && this._first > 0) {\n      let size = this._getSize(--this._first);\n      if (size === undefined) {\n        this._stable = false;\n        size = this._getAverageSize();\n      }\n      let margin = this._metricsCache.getMarginSize(this._first + 1);\n      if (margin === undefined) {\n        this._stable = false;\n        margin = this._metricsCache.averageMarginSize;\n      }\n      this._physicalMin -= size + margin;\n      const pos = this._physicalMin;\n      items.set(this._first, {pos, size});\n      if (this._stable === false && this._estimate === false) {\n        break;\n      }\n    }\n\n    while (this._physicalMax < upper && this._last < this._totalItems - 1) {\n      let margin = this._metricsCache.getMarginSize(++this._last);\n      if (margin === undefined) {\n        this._stable = false;\n        margin = this._metricsCache.averageMarginSize;\n      }\n      let size = this._getSize(this._last);\n      if (size === undefined) {\n        this._stable = false;\n        size = this._getAverageSize();\n      }\n      const pos = this._physicalMax + margin;\n      items.set(this._last, {pos, size});\n      this._physicalMax += margin + size;\n      if (this._stable === false && this._estimate === false) {\n        break;\n      }\n    }\n\n    // This handles the cases where we were relying on estimated sizes.\n    const extentErr = this._calculateError();\n    if (extentErr) {\n      this._physicalMin -= extentErr;\n      this._physicalMax -= extentErr;\n      this._anchorPos -= extentErr;\n      this._scrollPosition -= extentErr;\n      items.forEach((item) => item.pos -= extentErr);\n      this._scrollError += extentErr;\n    }\n\n    if (this._stable) {\n      this._newPhysicalItems = this._physicalItems;\n      this._newPhysicalItems.clear();\n      this._physicalItems = items;\n    }\n  }\n\n  _calculateError(): number {\n    const { averageMarginSize } = this._metricsCache;\n    if (this._first === 0) {\n      return this._physicalMin - (this._metricsCache.getMarginSize(0) ?? averageMarginSize);\n    } else if (this._physicalMin <= 0) {\n      return this._physicalMin - (this._first * this._delta);\n    } else if (this._last === this._totalItems - 1) {\n      return (this._physicalMax + (this._metricsCache.getMarginSize(this._totalItems) ?? averageMarginSize)) - this._scrollSize;\n    } else if (this._physicalMax >= this._scrollSize) {\n      return (\n          (this._physicalMax - this._scrollSize) +\n          ((this._totalItems - 1 - this._last) * this._delta));\n    }\n    return 0;\n  }\n\n  // TODO: Can this be made to inherit from base, with proper hooks?\n  _reflow() {\n    const {_first, _last, _scrollSize} = this;\n\n    this._updateScrollSize();\n    this._getActiveItems();\n\n    if (this._scrollSize !== _scrollSize) {\n      this._emitScrollSize();\n    }\n\n    this._updateVisibleIndices();\n    this._emitRange();\n    if (this._first === -1 && this._last === -1) {\n      this._resetReflowState();\n    } else if (\n        this._first !== _first || this._last !== _last ||\n        this._needsRemeasure) {\n      this._emitChildPositions();\n      this._emitScrollError();\n    } else {\n      this._emitChildPositions();\n      this._emitScrollError();\n      this._resetReflowState();\n    }\n  }\n\n  _resetReflowState() {\n    this._anchorIdx = null;\n    this._anchorPos = null;\n    this._stable = true;\n  }\n\n  _updateScrollSize() {\n    const { averageMarginSize } = this._metricsCache;\n    this._scrollSize = Math.max(1, this._totalItems * (averageMarginSize + this._getAverageSize()) + averageMarginSize);\n  }\n\n  /**\n   * Returns the average size (precise or estimated) of an item in the scrolling direction,\n   * including any surrounding space.\n   */\n  protected get _delta(): number {\n    const { averageMarginSize } = this._metricsCache;\n    return this._getAverageSize() + averageMarginSize;\n  }\n\n  /**\n   * Returns the top and left positioning of the item at idx.\n   */\n  _getItemPosition(idx: number): Positions {\n    return {\n      [this._positionDim]: this._getPosition(idx),\n      [this._secondaryPositionDim]: 0,\n      [offset(this.direction)]: -(this._metricsCache.getLeadingMarginValue(idx, this.direction) ?? this._metricsCache.averageMarginSize)\n    } as Positions;\n  }\n\n  /**\n   * Returns the height and width of the item at idx.\n   */\n  _getItemSize(idx: number): Size {\n    return {\n      [this._sizeDim]: (this._getSize(idx) || this._getAverageSize()) + (this._metricsCache.getMarginSize(idx + 1) ?? this._metricsCache.averageMarginSize),\n      [this._secondarySizeDim]: this._itemSize[this._secondarySizeDim]\n    } as Size;\n  }\n\n  _viewDim2Changed() {\n    this._needsRemeasure = true;\n    this._scheduleReflow();\n  }\n\n  _emitRange() {\n    const remeasure = this._needsRemeasure;\n    const stable = this._stable;\n    this._needsRemeasure = false;\n    super._emitRange({remeasure, stable});\n  }\n}\n","module.exports = function loadJSBundle(bundle) {\n  return new Promise(function (resolve, reject) {\n    var script = document.createElement('script');\n    script.async = true;\n    script.type = 'text/javascript';\n    script.charset = 'utf-8';\n    script.src = bundle;\n    script.onerror = function (e) {\n      script.onerror = script.onload = null;\n      reject(e);\n    };\n\n    script.onload = function () {\n      script.onerror = script.onload = null;\n      resolve();\n    };\n\n    document.getElementsByTagName('head')[0].appendChild(script);\n  });\n};\n"]}